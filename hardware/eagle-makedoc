#!/usr/bin/perl -w

$PROJECT_SHORT_NAME = $ARGV[0];
$sheets = $ARGV[1];

$VERSION = "0.02";

$layers = 6;

open(DESCRIPTION,"$PROJECT_SHORT_NAME.txt") || warn "Could not open description file.";

$PROJECT_LONG_NAME = <DESCRIPTION>;
chomp $PROJECT_LONG_NAME;
while(<DESCRIPTION>) {
	$PROJECT_DESCRIPTION .= $_;
}
	
print <<EOF;
\\documentclass{article}
\\usepackage{epsf}
\\usepackage[left=2cm,right=2cm,top=3cm]{geometry}
\\begin{document}
\\section*{$PROJECT_LONG_NAME}
$PROJECT_DESCRIPTION
\\listoffigures
\\par
Automagically generated by eagle-tools $VERSION, copyright 2005 Scott Torborg.
EOF

figure_adv($PROJECT_SHORT_NAME."_overview.eps","Board Overview","Board Overview","layers","!ht");

print "\\clearpage\n";

#print <<EOF;
#\\pagebreak
#EOF

figure($PROJECT_SHORT_NAME."_top.eps","Top Copper Layer","top");
if($layers > 2) {
    figure($PROJECT_SHORT_NAME."_ly1.eps","Inner Layer 1 Copper","ly1");
    figure($PROJECT_SHORT_NAME."_ly2.eps","Inner Layer 2 Copper","ly2");
    figure($PROJECT_SHORT_NAME."_ly3.eps","Inner Layer 3 Copper","ly3");
    figure($PROJECT_SHORT_NAME."_ly4.eps","Inner Layer 4 Copper","ly4");
}
figure($PROJECT_SHORT_NAME."_bottom.eps","Bottom Copper Layer","bottom");
figure($PROJECT_SHORT_NAME."_top_silk.eps","Top Silkscreen Layer","top_silk");
figure($PROJECT_SHORT_NAME."_bottom_silk.eps","Bottom Silkscreen Layer","bottom_silk");
figure($PROJECT_SHORT_NAME."_top_mask.eps","Top Soldermask Layer","top_mask");
figure($PROJECT_SHORT_NAME."_bottom_mask.eps","Bottom Soldermask Layer","bottom_mask");
figure($PROJECT_SHORT_NAME."_drill.eps","Drill Layer","drill");

print "\\clearpage\n";
figure_bom($PROJECT_SHORT_NAME."_parts.eps","Bill of Materials","Bill of Materials","bom");

for($num=1;$num<=$sheets;$num++) {
	figure_schem("$PROJECT_SHORT_NAME"."_s".$num.".eps","Schematic Sheet $num","Schematic Sheet $num","s$num");
}


print "\\end{document}\n";

sub figure {
	my ($filename, $caption, $ref) = @_;
	figure_adv($filename, $caption, $caption, $ref, "!ht");
}

sub figure_adv {
	my ($filename, $caption, $desc, $ref, $pos) = @_;
	print <<EOF;
\\begin{figure}[$pos]
	\\begin{center}
		\\leavevmode
		\\epsfbox{$filename}
	\\end{center}
	\\caption[$desc]{$caption}
	\\label{fig:$ref}
\\end{figure}
EOF
}

sub figure_schem {
    my ($filename, $caption, $desc, $ref) = @_;
    print <<EOF;
\\setlength{\\topmargin}{-1cm}
\\setlength{\\oddsidemargin}{-1cm}
\\setlength{\\evensidemargin}{-1cm}
\\begin{figure}[!ht]
    \\begin{center}
        \\leavevmode
        \\epsfysize=24cm
        \\epsfbox{$filename}
    \\end{center}
    \\caption[$desc]{$caption}
    \\label{fig:$ref}
\\end{figure}
\\thispagestyle{empty}
\\clearpage
EOF
}

sub figure_bom {
    my ($filename, $caption, $desc, $ref) = @_;
    print <<EOF;
\\setlength{\\topmargin}{-1cm}
\\setlength{\\oddsidemargin}{-1cm}
\\setlength{\\evensidemargin}{-1cm}
\\begin{figure}[!ht]
    \\begin{center}
        \\leavevmode
        \\epsfxsize=18cm
        \\epsfbox{$filename}
    \\end{center}
    \\caption[$desc]{$caption}
    \\label{fig:$ref}
\\end{figure}
\\thispagestyle{empty}
\\clearpage
EOF
}

